<html>
 <head>
  <link rel="stylesheet" href="maven-theme.css"> 
  <title>AppSecInc. MSI Extensions</title>
 </head>
 <body>


<!-- Generated by Doxygen 1.7.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>src/CustomActions/Cryptography/CryptProtectDataHex.cpp File Reference</h1>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_custom_actions_2_cryptography_2_std_afx_8h_source.html">StdAfx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_crypt_protect_data_hex_8h_source.html">CryptProtectDataHex.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="_custom_actions_2_cryptography_2_flag_maps_8h_source.html">FlagMaps.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">CA_API UINT __stdcall&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_crypt_protect_data_hex_8cpp.html#a18c716b3dde55ceb08811fb62acc12e3">CryptProtectDataHex</a> (MSIHANDLE hInstall)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">CryptProtectDataHex protects the data with a user or machine key and returns hex-encoded value of the data.  <a href="#a18c716b3dde55ceb08811fb62acc12e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">CA_API UINT __stdcall&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_crypt_protect_data_hex_8cpp.html#a8d30e6e5da612ac847e64ba85fb65434">CryptUnprotectDataHex</a> (MSIHANDLE hInstall)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">CryptUnprotectDataHex unprotects hex-encoded data with a user or machine key and returns value of the data.  <a href="#a8d30e6e5da612ac847e64ba85fb65434"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a18c716b3dde55ceb08811fb62acc12e3"></a><!-- doxytag: member="CryptProtectDataHex.cpp::CryptProtectDataHex" ref="a18c716b3dde55ceb08811fb62acc12e3" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall CryptProtectDataHex </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&#160;</td>
          <td class="paramname"><em>hInstall</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>CryptProtectDataHex protects the data with a user or machine key and returns hex-encoded value of the data. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">CRYPTPROTECT_DATA</td><td>Data to protect. </td></tr>
    <tr><td class="paramname">CRYPTPROTECT_ENTROPY</td><td>Optional entropy. </td></tr>
    <tr><td class="paramname">CRYPTPROTECT_FLAGS</td><td>Flags to pass to CryptProtectData. </p>
<ul>
<li>CRYPTPROTECT_LOCAL_MACHINE When this flag is set, it associates the data encrypted with the current computer instead of with an individual user. Any user on the computer on which CryptProtectData is called can use CryptUnprotectData to decrypt the data. </li>
<li>CRYPTPROTECT_UI_FORBIDDEN This flag is used for remote situations where presenting a user interface (UI) is not an option. When this flag is set and a UI is specified for either the protect or unprotect operation, the operation fails. </li>
<li>CRYPTPROTECT_AUDIT This flag generates an audit on protect and unprotect operations. </li>
<li>CRYPTPROTECT_VERIFY_PROTECTION This flag verifies the protection of a protected BLOB. </li>
</ul>
</td></tr>
    <tr><td class="paramname">CRYPTPROTECT_DESCRIPTION</td><td>Optional description of protect data (stored in clear). </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>CRYPTPROTECT_RESULT Hex-encoded protected data.</dd></dl>
<dl class="user"><dt><b>Example:</b></dt><dd></dd></dl>
<div class="fragment"><pre class="fragment">        &lt;Binary Id=<span class="stringliteral">&quot;Cryptography&quot;</span> SourceFile=<span class="stringliteral">&quot;relative path to Cryptography.dll&quot;</span>/&gt;
        &lt;Property Id=<span class="stringliteral">&quot;CRYPTPROTECT_DATA&quot;</span> Hidden=<span class="stringliteral">&quot;yes&quot;</span> /&gt;
        &lt;Property Id=<span class="stringliteral">&quot;CRYPTPROTECT_FLAGS&quot;</span> Value=<span class="stringliteral">&quot;CRYPTPROTECT_LOCAL_MACHINE|CRYPTPROTECT_UI_FORBIDDEN&quot;</span> /&gt;
        &lt;CustomAction Id=<span class="stringliteral">&quot;EncryptPassword&quot;</span> BinaryKey=<span class="stringliteral">&quot;Cryptography&quot;</span> DllEntry=<span class="stringliteral">&quot;CryptProtectDataHex&quot;</span>Execute=<span class="stringliteral">&quot;immediate&quot;</span> /&gt;
        &lt;CustomAction Id=<span class="stringliteral">&quot;SetDBUSERsPASSWORDForEncryption&quot;</span>Property=<span class="stringliteral">&quot;CRYPTPROTECT_DATA&quot;</span> Value=<span class="stringliteral">&quot;[PASSWORD]&quot;</span> /&gt;
        &lt;InstallExecuteSequence&gt; 
          &lt;Custom Action=<span class="stringliteral">&quot;SetDBUSERsPASSWORDForEncryption&quot;</span> After=<span class="stringliteral">&quot;InstallInitialize&quot;</span> /&gt;
          &lt;Custom Action=<span class="stringliteral">&quot;EncryptPassword&quot;</span> After=<span class="stringliteral">&quot;SetDBUSERsPASSWORDForEncryption&quot;</span> /&gt;
        &lt;/InstallExecuteSequence&gt;
</pre></div> 
<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>Support PromptStruct. </dd></dl>
</p>

</div>
</div>
<a class="anchor" id="a8d30e6e5da612ac847e64ba85fb65434"></a><!-- doxytag: member="CryptProtectDataHex.cpp::CryptUnprotectDataHex" ref="a8d30e6e5da612ac847e64ba85fb65434" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall CryptUnprotectDataHex </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&#160;</td>
          <td class="paramname"><em>hInstall</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>CryptUnprotectDataHex unprotects hex-encoded data with a user or machine key and returns value of the data. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">CRYPTUNPROTECT_DATA</td><td>Data to unprotect. </td></tr>
    <tr><td class="paramname">CRYPTUNPROTECT_ENTROPY</td><td>Optional entropy. </td></tr>
    <tr><td class="paramname">CRYPTUNPROTECT_FLAGS</td><td>Flags to pass to CryptUnrotectData. </p>
<ul>
<li>CRYPTPROTECT_LOCAL_MACHINE When this flag is set, it associates the data encrypted with the current computer instead of with an individual user. Any user on the computer on which CryptProtectData is called can use CryptUnprotectData to decrypt the data. </li>
<li>CRYPTPROTECT_UI_FORBIDDEN This flag is used for remote situations where presenting a user interface (UI) is not an option. When this flag is set and a UI is specified for either the protect or unprotect operation, the operation fails. </li>
<li>CRYPTPROTECT_AUDIT This flag generates an audit on protect and unprotect operations. </li>
<li>CRYPTPROTECT_VERIFY_PROTECTION This flag verifies the protection of a protected BLOB. </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>CRYPTUNPROTECT_RESULT Unprotected data. </dd>
<dd>
CRYPTUNPROTECT_DESCRIPTION Associated description.</dd></dl>
<dl class="user"><dt><b>Example:</b></dt><dd></dd></dl>
<div class="fragment"><pre class="fragment">        &lt;Binary Id=<span class="stringliteral">&quot;Cryptography&quot;</span> SourceFile=<span class="stringliteral">&quot;relative path to Cryptography.dll&quot;</span>/&gt;
        &lt;Property Id=<span class="stringliteral">&quot;CRYPTUNPROTECT_FLAGS&quot;</span> Value=<span class="stringliteral">&quot;CRYPTPROTECT_LOCAL_MACHINE|CRYPTPROTECT_UI_FORBIDDEN&quot;</span> /&gt;
        &lt;CustomAction Id=<span class="stringliteral">&quot;DecryptPassword&quot;</span> BinaryKey=<span class="stringliteral">&quot;Cryptography&quot;</span> DllEntry=<span class="stringliteral">&quot;CryptUnprotectDataHex&quot;</span>Execute=<span class="stringliteral">&quot;immediate&quot;</span> /&gt;
        &lt;CustomAction Id=<span class="stringliteral">&quot;SetDBUSERsDecryptedPASSWORD&quot;</span>Property=<span class="stringliteral">&quot;PASSWORD&quot;</span> Value=<span class="stringliteral">&quot;[CRYPTUNPROTECT_RESULT]&quot;</span>/&gt;
        &lt;InstallExecuteSequence&gt; 
          &lt;Custom Action=<span class="stringliteral">&quot;DecryptPassword&quot;</span> After=<span class="stringliteral">&quot;InstallInitialize&quot;</span>/&gt;
          &lt;Custom Action=<span class="stringliteral">&quot;SetDBUSERsDecryptedPASSWORD&quot;</span> After=<span class="stringliteral">&quot;DecryptPassword&quot;</span>/&gt;
        &lt;/InstallExecuteSequence&gt;
</pre></div> 
<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd>Support PromptStruct. </dd></dl>
</p>

</div>
</div>
</div>
  <br><hr noshade>
  <table width="100%">
   <tr>
    <td valign="top" align="left">
     <font size="1">&copy; Application Security Inc. - All Rights Reserved</font>
    </td>
    <td valign="top" align="right">
     <a href="http://msiext.codeplex.com" target="_blank">http://msiext.codeplex.com</a>
    </td>
   </tr>
  </table>
 </body>
 <head>
  <link href="tabs.css" rel="stylesheet" type="text/css">
 </head>
</html>
