<html>
 <head>
  <link rel="stylesheet" href="maven-theme.css"> 
  <title>AppSecInc. MSI Extensions</title>
 </head>
 <body>


<!-- Generated by Doxygen 1.5.5 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>src/CustomActions/DataSource/SqlODBC.h File Reference</h1>
<p>
<a href="_sql_o_d_b_c_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#4cdf957c45a4cf45b47a474761840d53">ODBC_Connect</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Test an ODBC connection.  <a href="#4cdf957c45a4cf45b47a474761840d53"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#50fb6ad47197512a3b8eded25a27dd43">ODBC_Execute</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute a SQL query, no result set.  <a href="#50fb6ad47197512a3b8eded25a27dd43"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#5826f597c8a0e9fc5d93303ad329499f">ODBC_GetString</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute a SQL query, return a string.  <a href="#5826f597c8a0e9fc5d93303ad329499f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#29c6b81dec17a66488ccc17a4fce16ed">ODBC_GetScalar</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute a SQL query, return a scalar.  <a href="#29c6b81dec17a66488ccc17a4fce16ed"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#ce6a5fede24577094f8bbb7cf778b33a">ODBC_GetXml</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute a SQL query, return xml data set.  <a href="#ce6a5fede24577094f8bbb7cf778b33a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#00dcb85f3c6655222754b19f39547c3a">Execute_ODBC_Immediate</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Table-driven immediate custom action that executes ODBC statements. Use in combination with <a class="el" href="class_app_sec_inc_1_1_wix_1_1_extensions_1_1_data_source_extension.html">AppSecInc::Wix::Extensions::DataSourceExtension</a>.  <a href="#00dcb85f3c6655222754b19f39547c3a"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#aec0601e525d78717f2234a2f5364dff">Execute_ODBC_Deferred</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Table-driven deferred custom action that executes ODBC statements. Use in combination with <a class="el" href="class_app_sec_inc_1_1_wix_1_1_extensions_1_1_data_source_extension.html">AppSecInc::Wix::Extensions::DataSourceExtension</a>.  <a href="#aec0601e525d78717f2234a2f5364dff"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#6633d451c938e07f0e32e9384e7370ad">DataSource_ODBC_Immediate</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Table-driven immediate custom action that manages ODBC datasources. Use in combination with <a class="el" href="class_app_sec_inc_1_1_wix_1_1_extensions_1_1_data_source_extension.html">AppSecInc::Wix::Extensions::DataSourceExtension</a>.  <a href="#6633d451c938e07f0e32e9384e7370ad"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">CA_API UINT __stdcall&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_sql_o_d_b_c_8h.html#1aa39c7657189014b2254e9c100c91a7">DataSource_ODBC_Deferred</a> (MSIHANDLE hInstall)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Table-driven deferred custom action that manages ODBC datasources. Use in combination with <a class="el" href="class_app_sec_inc_1_1_wix_1_1_extensions_1_1_data_source_extension.html">AppSecInc::Wix::Extensions::DataSourceExtension</a>.  <a href="#1aa39c7657189014b2254e9c100c91a7"></a><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="1aa39c7657189014b2254e9c100c91a7"></a><!-- doxytag: member="SqlODBC.h::DataSource_ODBC_Deferred" ref="1aa39c7657189014b2254e9c100c91a7" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall DataSource_ODBC_Deferred           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Table-driven deferred custom action that manages ODBC datasources. Use in combination with <a class="el" href="class_app_sec_inc_1_1_wix_1_1_extensions_1_1_data_source_extension.html">AppSecInc::Wix::Extensions::DataSourceExtension</a>. 
<p>

</div>
</div><p>
<a class="anchor" name="6633d451c938e07f0e32e9384e7370ad"></a><!-- doxytag: member="SqlODBC.h::DataSource_ODBC_Immediate" ref="6633d451c938e07f0e32e9384e7370ad" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall DataSource_ODBC_Immediate           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Table-driven immediate custom action that manages ODBC datasources. Use in combination with <a class="el" href="class_app_sec_inc_1_1_wix_1_1_extensions_1_1_data_source_extension.html">AppSecInc::Wix::Extensions::DataSourceExtension</a>. 
<p>

</div>
</div><p>
<a class="anchor" name="aec0601e525d78717f2234a2f5364dff"></a><!-- doxytag: member="SqlODBC.h::Execute_ODBC_Deferred" ref="aec0601e525d78717f2234a2f5364dff" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall Execute_ODBC_Deferred           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Table-driven deferred custom action that executes ODBC statements. Use in combination with <a class="el" href="class_app_sec_inc_1_1_wix_1_1_extensions_1_1_data_source_extension.html">AppSecInc::Wix::Extensions::DataSourceExtension</a>. 
<p>

</div>
</div><p>
<a class="anchor" name="00dcb85f3c6655222754b19f39547c3a"></a><!-- doxytag: member="SqlODBC.h::Execute_ODBC_Immediate" ref="00dcb85f3c6655222754b19f39547c3a" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall Execute_ODBC_Immediate           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Table-driven immediate custom action that executes ODBC statements. Use in combination with <a class="el" href="class_app_sec_inc_1_1_wix_1_1_extensions_1_1_data_source_extension.html">AppSecInc::Wix::Extensions::DataSourceExtension</a>. 
<p>

</div>
</div><p>
<a class="anchor" name="4cdf957c45a4cf45b47a474761840d53"></a><!-- doxytag: member="SqlODBC.h::ODBC_Connect" ref="4cdf957c45a4cf45b47a474761840d53" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall ODBC_Connect           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Test an ODBC connection. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ODBC_CONNECTION_STRING</em>&nbsp;</td><td>Connection string. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>ODBC_CONNECTION_ESTABLISHED Set to 1 if connection was successfully established. <p>
ODBC_ERROR Driver error when available.</dd></dl>
This custom action supports impersonation, see <a class="el" href="impersonate.html">Impersonation in Immediate Custom Actions</a>.<p>
<dl class="user" compact><dt><b>Example:</b></dt><dd></dd></dl>
<div class="fragment"><pre class="fragment">&lt;Dialog Id=<span class="stringliteral">"InvalidLogonDlg"</span> Width=<span class="stringliteral">"260"</span> Height=<span class="stringliteral">"85"</span> Title=<span class="stringliteral">"Invalid Logon"</span>&gt;
 &lt;Control Id=<span class="stringliteral">"Return"</span> Type=<span class="stringliteral">"PushButton"</span> X=<span class="stringliteral">"102"</span> Y=<span class="stringliteral">"57"</span> Width=<span class="stringliteral">"56"</span> Height=<span class="stringliteral">"17"</span> Default=<span class="stringliteral">"yes"</span> Cancel=<span class="stringliteral">"yes"</span> Text=<span class="stringliteral">"OK"</span>&gt;
  &lt;Publish Event=<span class="stringliteral">"EndDialog"</span> Value=<span class="stringliteral">"Return"</span>&gt;1&lt;/Publish&gt;
 &lt;/Control&gt;
 &lt;Control Id=<span class="stringliteral">"Text"</span> Type=<span class="stringliteral">"Text"</span> X=<span class="stringliteral">"48"</span> Y=<span class="stringliteral">"15"</span> Width=<span class="stringliteral">"194"</span> Height=<span class="stringliteral">"30"</span> Text=<span class="stringliteral">"[LOGON_ERROR]"</span> /&gt;
 &lt;Control Id=<span class="stringliteral">"Icon"</span> Type=<span class="stringliteral">"Icon"</span> X=<span class="stringliteral">"15"</span> Y=<span class="stringliteral">"15"</span> Width=<span class="stringliteral">"24"</span> Height=<span class="stringliteral">"24"</span> FixedSize=<span class="stringliteral">"yes"</span> IconSize=<span class="stringliteral">"32"</span> Text=<span class="stringliteral">"WixUI_Ico_Exclam"</span> /&gt;
&lt;/Dialog&gt;
...
&lt;Control Id=<span class="stringliteral">"TestButton"</span> Type=<span class="stringliteral">"PushButton"</span> X=<span class="stringliteral">"40"</span> Y=<span class="stringliteral">"215"</span> Width=<span class="stringliteral">"100"</span> Height=<span class="stringliteral">"17"</span> Text=<span class="stringliteral">"Test Connection"</span>&gt;
 &lt;Publish Property=<span class="stringliteral">"ODBC_SERVER"</span> Value=<span class="stringliteral">"[DATABASE_SERVER]"</span> Order=<span class="stringliteral">"1"</span>&gt;1&lt;/Publish&gt;
 &lt;Publish Property=<span class="stringliteral">"ODBC_SERVER"</span> Value=<span class="stringliteral">"[ComputerName]"</span> Order=<span class="stringliteral">"1"</span>&gt;&lt;![CDATA[DATABASE_SERVER = <span class="stringliteral">"(local)"</span>]]&gt;&lt;/Publish&gt;
 &lt;Publish Property=<span class="stringliteral">"ODBC_CONNECTION_STRING"</span> Value=<span class="stringliteral">"Driver=SQL Server;Server=[ODBC_SERVER],1433;Uid=[DATABASE_USERNAME];Pwd=[DATABASE_PASSWORD]"</span> Order=<span class="stringliteral">"2"</span>&gt;1&lt;/Publish&gt;
 &lt;Publish Event=<span class="stringliteral">"DoAction"</span> Value=<span class="stringliteral">"ODBC_Connect"</span> Order=<span class="stringliteral">"3"</span>&gt;1&lt;/Publish&gt;
 &lt;Publish Property=<span class="stringliteral">"LOGON_VALID"</span> Value=<span class="stringliteral">"1"</span> Order=<span class="stringliteral">"4"</span>&gt;&lt;![CDATA[ODBC_CONNECTION_ESTABLISHED]]&gt;&lt;/Publish&gt;
 &lt;Publish Property=<span class="stringliteral">"LOGON_VALID"</span> Value=<span class="stringliteral">"0"</span> Order=<span class="stringliteral">"4"</span>&gt;&lt;![CDATA[NOT ODBC_CONNECTION_ESTABLISHED]]&gt;&lt;/Publish&gt;
 &lt;Publish Property=<span class="stringliteral">"LOGON_ERROR"</span> Value=<span class="stringliteral">"Unexpected Error"</span> Order=<span class="stringliteral">"4"</span>&gt;&lt;![CDATA[(NOT ODBC_CONNECTION_ESTABLISHED) AND (ODBC_ERROR = <span class="stringliteral">""</span>)]]&gt;&lt;/Publish&gt;
 &lt;Publish Property=<span class="stringliteral">"LOGON_ERROR"</span> Value=<span class="stringliteral">"[ODBC_ERROR]"</span> Order=<span class="stringliteral">"4"</span>&gt;&lt;![CDATA[NOT ODBC_CONNECTION_ESTABLISHED]]&gt;&lt;/Publish&gt;
 &lt;Publish Event=<span class="stringliteral">"SpawnDialog"</span> Value=<span class="stringliteral">"InvalidLogonDlg"</span> Order=<span class="stringliteral">"5"</span>&gt;&lt;![CDATA[NOT ODBC_CONNECTION_ESTABLISHED]]&gt;&lt;/Publish&gt;
&lt;/Control&gt;
</pre></div> 
</div>
</div><p>
<a class="anchor" name="50fb6ad47197512a3b8eded25a27dd43"></a><!-- doxytag: member="SqlODBC.h::ODBC_Execute" ref="50fb6ad47197512a3b8eded25a27dd43" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall ODBC_Execute           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Execute a SQL query, no result set. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ODBC_CONNECTION_STRING</em>&nbsp;</td><td>Connection string. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ODBC_SQL_QUERY</em>&nbsp;</td><td>Query to execute.</td></tr>
  </table>
</dl>
This custom action supports impersonation, see <a class="el" href="impersonate.html">Impersonation in Immediate Custom Actions</a>. 
</div>
</div><p>
<a class="anchor" name="29c6b81dec17a66488ccc17a4fce16ed"></a><!-- doxytag: member="SqlODBC.h::ODBC_GetScalar" ref="29c6b81dec17a66488ccc17a4fce16ed" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall ODBC_GetScalar           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Execute a SQL query, return a scalar. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ODBC_CONNECTION_STRING</em>&nbsp;</td><td>Connection string. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ODBC_SQL_QUERY</em>&nbsp;</td><td>Query to execute. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>ODBC_SQL_RESULT The returned scalar.</dd></dl>
This custom action supports impersonation, see <a class="el" href="impersonate.html">Impersonation in Immediate Custom Actions</a>. 
</div>
</div><p>
<a class="anchor" name="5826f597c8a0e9fc5d93303ad329499f"></a><!-- doxytag: member="SqlODBC.h::ODBC_GetString" ref="5826f597c8a0e9fc5d93303ad329499f" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall ODBC_GetString           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Execute a SQL query, return a string. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ODBC_CONNECTION_STRING</em>&nbsp;</td><td>Connection string. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ODBC_SQL_QUERY</em>&nbsp;</td><td>Query to execute. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ODBC_SQL_FLAGS</em>&nbsp;</td><td>Optional, possible flags are: ODBC_SQL_FLAG_NO_ROWS_RETURN_EMPTY </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>ODBC_SQL_RESULT The returned record.</dd></dl>
This custom action supports impersonation, see <a class="el" href="impersonate.html">Impersonation in Immediate Custom Actions</a>.<p>
<dl class="user" compact><dt><b>Example: Implementing "Recommend Path" with Microsoft SQL Server</b></dt><dd></dd></dl>
Sometimes your application needs to prompt the user for a specific directory where a database should be installed. Most of the time the users want to install the database in the default SQL Server directory. This value is stored in HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\MSSQL.1\Setup on the server and can be obtained with the the following T-SQL.<p>
<div class="fragment"><pre class="fragment">DECLARE @data_dir varchar(500)
EXECUTE master.dbo.xp_instance_regread 'HKEY_LOCAL_MACHINE', 'SOFTWARE\Microsoft\MSSQLServer\Setup', 'SQLDataRoot', @param = @data_dir OUTPUT
SELECT @data_dir
</pre></div><p>
The query can be easily incorporated under a "Recommend Path" button in a wix UI using the ODBC_GetString custom action.<p>
<div class="fragment"><pre class="fragment">&lt;Dialog Id=<span class="stringliteral">"MSSQLDatabaseRecommendPathDlg"</span> Width=<span class="stringliteral">"370"</span> Height=<span class="stringliteral">"270"</span> Title=<span class="stringliteral">"Database Path Options"</span>&gt;
 ...
 &lt;Control Id=<span class="stringliteral">"DatabaseMDFPathLabel"</span> Type=<span class="stringliteral">"Text"</span> X=<span class="stringliteral">"20"</span> Y=<span class="stringliteral">"85"</span> Height=<span class="stringliteral">"15"</span> Width=<span class="stringliteral">"150"</span> Text=<span class="stringliteral">"Database data file path:"</span> /&gt;
 &lt;Control Id=<span class="stringliteral">"DatabaseMDFPath"</span> Type=<span class="stringliteral">"Edit"</span> X=<span class="stringliteral">"30"</span> Y=<span class="stringliteral">"100"</span> Height=<span class="stringliteral">"17"</span> Width=<span class="stringliteral">"320"</span> Property=<span class="stringliteral">"MSSQL_DATABASE_MDF_PATH"</span> /&gt;
 &lt;Control Id=<span class="stringliteral">"DatabaseLDFPathLabel"</span> Type=<span class="stringliteral">"Text"</span> X=<span class="stringliteral">"20"</span> Y=<span class="stringliteral">"120"</span> Height=<span class="stringliteral">"15"</span> Width=<span class="stringliteral">"150"</span> Text=<span class="stringliteral">"Database log file path:"</span> /&gt;
 &lt;Control Id=<span class="stringliteral">"DatabaseLDFPath"</span> Type=<span class="stringliteral">"Edit"</span> X=<span class="stringliteral">"30"</span> Y=<span class="stringliteral">"135"</span> Height=<span class="stringliteral">"17"</span> Width=<span class="stringliteral">"320"</span> Property=<span class="stringliteral">"MSSQL_DATABASE_LDF_PATH"</span> /&gt;
 &lt;Control Id=<span class="stringliteral">"RecommendPath"</span> Type=<span class="stringliteral">"PushButton"</span> X=<span class="stringliteral">"40"</span> Y=<span class="stringliteral">"155"</span> Width=<span class="stringliteral">"100"</span> Height=<span class="stringliteral">"17"</span> Text=<span class="stringliteral">"Recommend Path"</span>&gt;
  &lt;Publish Property=<span class="stringliteral">"ODBC_CONNECTION_STRING"</span> Value=<span class="stringliteral">"Driver=SQL Server;Server=.;Trusted_Connection=yes;"</span> Order=<span class="stringliteral">"1"</span>&gt;1&lt;/Publish&gt;
  &lt;Publish Property=<span class="stringliteral">"ODBC_SQL_QUERY"</span> Value=<span class="stringliteral">"DECLARE @data_dir varchar(500); EXECUTE master.dbo.xp_instance_regread 'HKEY_LOCAL_MACHINE', 'SOFTWARE\Microsoft\MSSQLServer\Setup', 'SQLDataRoot', @param = @data_dir OUTPUT; SELECT @data_dir"</span> Order=<span class="stringliteral">"1"</span>&gt;1&lt;/Publish&gt;
  &lt;Publish Event=<span class="stringliteral">"DoAction"</span> Value=<span class="stringliteral">"ODBC_GetString"</span> Order=<span class="stringliteral">"3"</span>&gt;1&lt;/Publish&gt;
  &lt;Publish Property=<span class="stringliteral">"MSSQL_DATABASE_MDF_PATH"</span> Value=<span class="stringliteral">"[ODBC_SQL_RESULT]\[MSSQL_DATABASE_NAME].mdf"</span> Order=<span class="stringliteral">"4"</span>&gt;1&lt;/Publish&gt;
  &lt;Publish Property=<span class="stringliteral">"MSSQL_DATABASE_LDF_PATH"</span> Value=<span class="stringliteral">"[ODBC_SQL_RESULT]\[MSSQL_DATABASE_NAME].ldf"</span> Order=<span class="stringliteral">"4"</span>&gt;1&lt;/Publish&gt;
  &lt;Publish Event=<span class="stringliteral">"SpawnDialog"</span> Value=<span class="stringliteral">"CaErrorDlg"</span> Order=<span class="stringliteral">"5"</span>&gt;CA_ERROR&lt;/Publish&gt;
 &lt;/Control&gt;
 ...
&lt;/Dialog&gt;
</pre></div> 
</div>
</div><p>
<a class="anchor" name="ce6a5fede24577094f8bbb7cf778b33a"></a><!-- doxytag: member="SqlODBC.h::ODBC_GetXml" ref="ce6a5fede24577094f8bbb7cf778b33a" args="(MSIHANDLE hInstall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CA_API UINT __stdcall ODBC_GetXml           </td>
          <td>(</td>
          <td class="paramtype">MSIHANDLE&nbsp;</td>
          <td class="paramname"> <em>hInstall</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Execute a SQL query, return xml data set. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ODBC_CONNECTION_STRING</em>&nbsp;</td><td>Connection string. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ODBC_SQL_QUERY</em>&nbsp;</td><td>Query to execute. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>ODBC_SQL_RESULT The returned data set, in xml format.</dd></dl>
The xml data returned looks like this:<p>
<div class="fragment"><pre class="fragment">&lt;Data columns=<span class="stringliteral">"number of columns"</span> rows=<span class="stringliteral">"number of rows"</span>&gt;
 &lt;Query&gt;query executed&lt;/Query&gt;
 &lt;DataSet&gt;
  &lt;Row&gt;
   &lt;column1&gt;value of column 1&lt;/column1&gt;
   &lt;column2&gt;value of column 2&lt;/column2&gt;
   ...
  &lt;/Row&gt;
  &lt;Row&gt;
   ...
  &lt;/Row&gt;
 &lt;/DataSet&gt;
&lt;/Data&gt;
</pre></div><p>
This custom action supports impersonation, see <a class="el" href="impersonate.html">Impersonation in Immediate Custom Actions</a>. 
</div>
</div><p>
</div>
  <br><hr noshade>
  <table width="100%">
   <tr>
    <td valign="top" align="left">
     <font size="1">&copy; Application Security Inc. - All Rights Reserved</font>
    </td>
    <td valign="top" align="right">
     <a href="http://msiext.codeplex.com" target="_blank">http://msiext.codeplex.com</a>
    </td>
   </tr>
  </table>
 </body>
 <head>
  <link href="tabs.css" rel="stylesheet" type="text/css">
 </head>
</html>
